<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Comelón: Invasión de Fantasmas Gigantes</title>
    <style>
        body { margin: 0; padding: 0; background-color: #000; overflow: hidden; font-family: 'Courier New', Courier, monospace; }
        canvas { display: block; }
        
        #ui {
            position: absolute; top: 20px; left: 20px;
            color: #fff; font-size: 20px; pointer-events: none;
            text-shadow: 0 0 10px #fff;
            line-height: 1.5;
        }

        .highlight-blue { color: #00ffff; text-shadow: 0 0 10px #00ffff; }
        .highlight-green { color: #00ff00; text-shadow: 0 0 10px #00ff00; }

        #overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.95);
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            z-index: 100; text-align: center;
        }

        #mensaje-final {
            display: none;
            position: fixed; top: 50%; left: 50%;
            transform: translate(-50%, -50%);
            text-align: center; z-index: 200;
            background: rgba(20, 0, 0, 0.9);
            padding: 40px; border: 3px solid #ff0055;
            box-shadow: 0 0 50px #ff0055;
        }

        .titulo-muerte { color: #fff; font-size: 28px; font-weight: bold; margin-bottom: 15px; }
        .causa { color: #ff0055; font-size: 32px; font-weight: 900; text-transform: uppercase; letter-spacing: 8px; animation: blink 0.5s infinite; }

        @keyframes blink { 0%, 100% { opacity: 1; } 50% { opacity: 0.3; } }

        button {
            background: transparent; border: 2px solid #fff; color: #fff;
            padding: 15px 30px; font-size: 18px; cursor: pointer; font-family: inherit;
            box-shadow: 0 0 15px #fff; transition: 0.3s; margin-top: 30px;
        }
        button:hover { background: #fff; color: #000; }
    </style>
</head>
<body>

    <div id="overlay">
        <h1 style="letter-spacing: 15px; color: #00ffcc; font-size: 60px; text-shadow: 0 0 20px #00ffcc;">COMELÓN</h1>
        <p style="color: white;">¡Los fantasmas gigantes se mueven! Digiere para sobrevivir.</p>
        <button onclick="iniciarJuego()">INICIAR SISTEMA</button>
    </div>

    <div id="mensaje-final">
        <div class="titulo-muerte">HAS EXPLOTADO A TU CIEMPIÉS</div>
        <div style="color: #aaa; margin-top: 15px; font-size: 14px;">REPORTE DE DAÑOS - CAUSA DE MUERTE:</div>
        <div class="causa">OBESIDAD</div>
        <div id="estadisticas-finales" style="color: white; margin-top: 20px;"></div>
        <button onclick="location.reload()">REINTENTAR</button>
    </div>

    <div id="ui">
        NIVEL BIO-MASA: <span id="score" class="highlight-blue">0</span> / 15<br>
        DIGERIDOS: <span id="digeridos" class="highlight-green">0</span>
    </div>
    
    <canvas id="canvas"></canvas>

<script>
const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');
const scoreEl = document.getElementById('score');
const digeridosEl = document.getElementById('digeridos');
const overlay = document.getElementById('overlay');
const mensajeFinal = document.getElementById('mensaje-final');

let width, height;
let mouse = { x: 0, y: 0 };
let head = { x: 0, y: 0 };
let score = 0; 
let totalDigeridos = 0;
let juegoIniciado = false;
let estado = "jugando"; 
let factorGordo = 1;
let particulas = [];
let hueBase = 0;

const segmentos = [];
const distanciaSegmentos = 6;
const numSegmentosMinimo = 40;

const fantasmas = [];
const refrescos = [];
const coloresFantasmas = ['#FF0000', '#FFB8FF', '#00FFFF', '#FFB852'];

function iniciarJuego() {
    overlay.style.display = 'none';
    juegoIniciado = true;
    animate();
}

window.addEventListener('resize', resize);
window.addEventListener('mousemove', e => {
    mouse.x = e.clientX;
    mouse.y = e.clientY;
});

function resize() {
    width = canvas.width = window.innerWidth;
    height = canvas.height = window.innerHeight;
}

class Refresco {
    constructor() { this.spawn(); }
    spawn() {
        this.x = Math.random() * (width - 100) + 50;
        this.y = Math.random() * (height - 100) + 50;
        this.vx = (Math.random() - 0.5) * 8;
        this.vy = (Math.random() - 0.5) * 8;
        this.alive = true;
    }
    update() {
        if (!this.alive) return;
        this.x += this.vx; this.y += this.vy;
        if (this.x < 15 || this.x > width - 15) this.vx *= -1;
        if (this.y < 15 || this.y > height - 15) this.vy *= -1;
    }
    draw() {
        if (!this.alive) return;
        ctx.save();
        ctx.fillStyle = "#00ff00";
        ctx.shadowBlur = 20; ctx.shadowColor = "#00ff00";
        ctx.fillRect(this.x - 12, this.y - 18, 24, 36);
        ctx.fillStyle = "#fff";
        ctx.font = "bold 12px Arial";
        ctx.fillText("SODA", this.x - 17, this.y + 5);
        ctx.restore();
    }
}

class Fantasma {
    constructor() { this.spawn(); }
    spawn() {
        this.x = Math.random() * (width - 100) + 50;
        this.y = Math.random() * (height - 100) + 50;
        this.vx = (Math.random() - 0.5) * 4; // Movimiento del fantasma
        this.vy = (Math.random() - 0.5) * 4;
        this.color = coloresFantasmas[Math.floor(Math.random() * coloresFantasmas.length)];
        this.size = 20; // 130% aproximadamente (de 15 a 20)
        this.alive = true;
    }
    update() {
        if (!this.alive) return;
        this.x += this.vx; this.y += this.vy;
        if (this.x < this.size || this.x > width - this.size) this.vx *= -1;
        if (this.y < this.size || this.y > height - this.size) this.vy *= -1;
    }
    draw() {
        if (!this.alive) return;
        ctx.save();
        ctx.shadowBlur = 15; ctx.shadowColor = this.color;
        ctx.fillStyle = this.color;
        ctx.beginPath();
        // Cabeza gigante
        ctx.arc(this.x, this.y, this.size, Math.PI, 0);
        ctx.lineTo(this.x + this.size, this.y + 25);
        ctx.lineTo(this.x - this.size, this.y + 25);
        ctx.fill();
        
        // Ojos proporcionales
        ctx.fillStyle = "white";
        ctx.beginPath();
        ctx.arc(this.x - 8, this.y - 4, 6, 0, Math.PI * 2);
        ctx.arc(this.x + 8, this.y - 4, 6, 0, Math.PI * 2);
        ctx.fill();
        
        ctx.fillStyle = "black";
        ctx.beginPath();
        ctx.arc(this.x - 8, this.y - 4, 3, 0, Math.PI * 2);
        ctx.arc(this.x + 8, this.y - 4, 3, 0, Math.PI * 2);
        ctx.fill();
        ctx.restore();
    }
}

class Segmento {
    constructor(x, y, index) {
        this.x = x; this.y = y;
        this.index = index;
        this.angle = 0;
        this.currentHue = 0;
    }
    update(targetX, targetY) {
        if (estado === "explotado") return;
        const dx = targetX - this.x;
        const dy = targetY - this.y;
        this.angle = Math.atan2(dy, dx);
        this.x = targetX - Math.cos(this.angle) * distanciaSegmentos;
        this.y = targetY - Math.sin(this.angle) * distanciaSegmentos;
    }
    draw() {
        const hue = (hueBase + (this.index * 6)) % 360;
        this.currentHue = hue;
        ctx.save();
        let shake = estado === "inflando" ? (Math.random() - 0.5) * factorGordo * 10 : 0;
        ctx.translate(this.x + shake, this.y + shake);
        ctx.rotate(this.angle);
        ctx.strokeStyle = `hsl(${hue}, 100%, 50%)`;
        ctx.lineWidth = 2.5;
        ctx.shadowBlur = 15;
        ctx.shadowColor = `hsl(${hue}, 100%, 50%)`;

        const baseSize = Math.max(5, 18 - (this.index * 0.1)); 
        const size = baseSize * factorGordo;
        
        ctx.beginPath();
        ctx.moveTo(0, -size); ctx.lineTo(0, size);
        ctx.stroke();

        if (this.index % 3 === 0) {
            const t = Date.now() * 0.01 + this.index;
            const move = Math.sin(t) * 8;
            ctx.beginPath();
            ctx.moveTo(0, size);
            ctx.lineTo(-15 * factorGordo, (size + 15 + move) * factorGordo);
            ctx.moveTo(0, -size);
            ctx.lineTo(-15 * factorGordo, -(size + 15 + move) * factorGordo);
            ctx.stroke();
        }

        if (this.index === 0) {
            ctx.beginPath(); ctx.arc(6, 0, 10 * factorGordo, 0, Math.PI * 2); ctx.stroke();
            ctx.beginPath(); ctx.moveTo(8, -5); ctx.lineTo(20 * factorGordo, -15 * factorGordo);
            ctx.moveTo(8, 5); ctx.lineTo(20 * factorGordo, 15 * factorGordo); ctx.stroke();
        }
        ctx.restore();
    }
}

resize();
head.x = width/2; head.y = height/2;
for (let i = 0; i < numSegmentosMinimo; i++) {
    segmentos.push(new Segmento(head.x, head.y, i));
}
for (let i = 0; i < 5; i++) fantasmas.push(new Fantasma());
for (let i = 0; i < 2; i++) refrescos.push(new Refresco());

function animate() {
    ctx.fillStyle = "rgba(0, 0, 0, 0.4)";
    ctx.fillRect(0, 0, width, height);
    hueBase += 3;

    if (estado !== "explotado") {
        if (estado === "jugando") {
            head.x += (mouse.x - head.x) * 0.15;
            head.y += (mouse.y - head.y) * 0.15;
        } else if (estado === "inflando") {
            factorGordo += 0.08;
            if (factorGordo > 8) reventar();
        }

        // Fantasmas actualización y colisión
        fantasmas.forEach(f => {
            if (!f.alive || estado === "inflando") return;
            f.update();
            f.draw();
            if (Math.hypot(head.x - f.x, head.y - f.y) < 35) {
                f.alive = false;
                score++;
                scoreEl.innerText = score;
                for(let j=0; j<15; j++) {
                    segmentos.push(new Segmento(segmentos[segmentos.length-1].x, segmentos[segmentos.length-1].y, segmentos.length));
                }
                if (score >= 15) estado = "inflando";
                else setTimeout(() => f.spawn(), 1500);
            }
        });

        // Refrescos actualización y colisión
        refrescos.forEach(r => {
            if (!r.alive || estado === "inflando") return;
            r.update(); r.draw();
            if (Math.hypot(head.x - r.x, head.y - r.y) < 35) {
                r.alive = false;
                if (score > 0) {
                    let cant = Math.min(score, 2);
                    score -= cant;
                    totalDigeridos += cant;
                    scoreEl.innerText = score;
                    digeridosEl.innerText = totalDigeridos;
                }
                for(let j=0; j<35; j++) { 
                    if(segmentos.length > numSegmentosMinimo) segmentos.pop(); 
                }
                setTimeout(() => r.spawn(), 4000);
            }
        });

        let tx = head.x, ty = head.y;
        segmentos.forEach(seg => {
            seg.update(tx, ty); seg.draw();
            tx = seg.x; ty = seg.y;
        });
    } else {
        particulas.forEach((p, i) => {
            p.x += p.vx; p.y += p.vy; p.life -= 0.02;
            ctx.fillStyle = p.color; ctx.globalAlpha = p.life;
            ctx.fillRect(p.x, p.y, 4, 4);
            if(p.life <= 0) particulas.splice(i, 1);
        });
    }
    requestAnimationFrame(animate);
}

function reventar() {
    estado = "explotado";
    document.getElementById('estadisticas-finales').innerHTML = `Lograste digerir <b>${totalDigeridos}</b> fantasmas.`;
    segmentos.forEach(seg => {
        for(let i=0; i<15; i++) {
            particulas.push({
                x: seg.x, y: seg.y, vx: (Math.random()-0.5)*35, vy: (Math.random()-0.5)*35,
                color: `hsl(${seg.currentHue}, 100%, 50%)`, life: 1.0
            });
        }
    });
    setTimeout(() => { mensajeFinal.style.display = 'block'; }, 800);
}
</script>
</body>
</html>
